<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Manage Video Uploads</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    </head>
    <body>
        <div class="video-list-container">
            <div class="list-controls">
                <div class="video-filter">
                    <p>Filter</p>
                    <select name="videoStatus" id="video_status">
                        <option value="Pending">Pending</option>
                        <option value="Rejected">Rejected</option>
                        <option value="Deleted">Deleted</option>
                    </select>
                    <select name="videoType" id="video_type">
                        <option value="all">All</option>
                        <option value="performance">Performance</option>
                        <option value="lesson">Lesson</option>
                    </select>
                </div>
                <div class="video-sort"></div>
                    <p>Sort By</p>
                    <select name="videoSort" id="video_sort">
                        <option value="first">Newest</option>
                        <option value="last">Oldest</option>
                        <option value="titleAsc">Title (Ascending)</option>
                        <option value="titleDesc">Title (Descending)</option>
                    </select>
                </div>
            </div>
            <div id="video-list"></div>
        </div>
    </body>
</html>

<script type="text/javascript">
    var videoType = $('#video_type').val();
    var videoStatus = $('#video_status').val();
    var sortValue = $('#video_sort').val();

    function fetchInitialVideos() {
        $.ajax({
            url: "fetch_admin_video.php",
            type: "POST",
            data: {
                limit: 15,
                start: 0,
                videoType: videoType,
                videoStatus: videoStatus,
                sortValue: sortValue
            },
            cache:false,
            success:function(data) {
                $("#video-list").html(data);
            }
        });
    }

    fetchInitialVideos();
    
    $(document).ready(function() {
    
        var limit = 15;
        var start = 15;
        
        var timeout;
        $(window).scroll(function(){
            clearTimeout(timeout);
            timeout = setTimeout(function() {
                if ($(window).scrollTop() >= $('#video-list').offset().top + $('#video-list').outerHeight() - window.innerHeight) {
                    load_video();
                }
            }, 50);
        });

        function load_video() {
            $.ajax({
                url: "fetch_admin_video.php",
                type: "POST",
                data: {
                    limit: limit,
                    start: start,
                    videoType: videoType,
                    videoStatus: videoStatus,
                    sortValue: sortValue
                },
                cache:false,
                success:function(data) {
                    if (data != '') {
                        $("#video-list").append(data);
                        start += limit;
                    }
                }
            });
        }

        $('#video_type').change(function() {
            start = 15;
            videoType = $('#video_type').val();
            fetchInitialVideos();
        });

        $('#video_status').change(function() {
            start = 15;
            videoStatus = $('#video_status').val();
            fetchInitialVideos();
        });

        $('#video_sort').change(function() {
            start = 15;
            sortValue = $('#video_sort').val();
            fetchInitialVideos();
        });
    
    });
</script>

<script type="text/javascript">		//script for approving/rejecting or deleting videos
    $(document).ready(function() {
        $("#video-list").on('click', '.submitBtn', function (e) {
            e.preventDefault();
            var action = $(this).attr('name');
            var videoId = $(this).val();
            $.ajax({
                url: "manage_video_status.php",
                type: "POST",
                data: {
                    videoId: videoId,
                    action: action
                },
                cache:false,
                success: function(response){
                    if (response == "unexpected_error") {
                        window.location = "home.php?error=unexpected_error";
                    }
                    else {
                        $("#" + videoId).remove();
                    }
                }
            });
        });

    });
</script>